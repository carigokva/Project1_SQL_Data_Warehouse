-- Scripts for creating product dimension table / materialized view
-- All names must use meaningful, business-aligned names for tables, starting with the category prefix.
-- <layer>.<category>_<entity>
--	<category>: Describes the role of the table, such as dim (dimension) or fact (fact table)
--	<entity>: Descriptive name of the table, aligned with the business domain (e.g., customers, products, sales)
--	Examples:
--		gold.dim_customers - dimension table for customer data.
--		gold.fact_sales - fact table for sales transactions.

-- View name: gold.dim_products
-- Contains the data of customer dimension table in the gold layer
-- All customer dimension table in the silver layer are aggregated into a single table

-- Considerations before building the product dimension table:
-- t1 = crm_prd_info, t2 = erp_px_cat_g1v2
-- Select only the needed columns for analysis

/* This is the script to be stored in the product dimension view

SELECT
	t1.prd_id,
	t1.cat_id,
	t1.prd_key,
	t1.prd_nm,
	t1.prd_cost,
	t1.prd_line,
	t1.prd_start_dt,
	t2.cat,
	t2.subcat,
	t2.maintenance
FROM silver.crm_prd_info AS t1
LEFT JOIN silver.erp_px_cat_g1v2 AS t2
ON t1.cat_id = t2.id;

*/
	

DROP MATERIALIZED VIEW IF EXISTS gold.dim_products;

CREATE MATERIALIZED VIEW gold.dim_products AS
SELECT
	t1.prd_id AS product_id,
	t1.cat_id AS category_id,
	t1.prd_key AS product_number,
	t1.prd_nm AS product_name,
	t1.prd_cost AS cost,
	t1.prd_line AS product_line,
	t2.cat AS category,
	t2.subcat AS subcategory,
	t2.maintenance AS maintenance,
	t1.prd_start_dt AS start_date
FROM silver.crm_prd_info AS t1
LEFT JOIN silver.erp_px_cat_g1v2 AS t2
ON t1.cat_id = t2.id;
